{
	"$schema": "http://json-schema.org/draft-07/schema#",
	"title": "Serverless completer Schema",
	"type": "object",
	"id": "https://example.com/completer.json",
	"required": ["service"],
	"properties": {
		"service": {
			"oneOf": [
				{ "type": "string" },
				{
					"type": "object",
					"properties": {
						"name": { "type": "string" },
						"awsKmsKeyArn": {
							"type": "string",
							"description": "Optional KMS key arn which will be used for encryption for all functions"
						}
					}
				}
			]
		},
		"plugins": {
			"type": "array",
			"items": {
				"type": "string",
				"anyOf": [
					{ "type": "string" },
					{ "type": "string", "enum": ["serverless-localstack"] }
				]
			}
		},
		"custom": {
			"type": "object",
			"anyOf": [
				{
					"patternProperties": {
						"^.*$": {
							"type": "object"
						}
					}
				},
				{
					"$ref": "#/definitions/CustomLocalstack"
				}
			]
		},
		"functions": {
			"type": "object",
			"patternProperties": {
				"^.*$": {
					"type": "object",
					"required": ["handler"],
					"properties": {
						"runtime": { "$ref": "#/definitions/AWSRunTime" },
						"handler": { "type": "string" },
						"name": { "type": "string" },
						"description": { "type": "string" },
						"memorySize": { "type": "number" },
						"reservedConcurrency": { "type": "number" },
						"provisionedConcurrency": { "type": "number" },
						"role": { "type": "string" },
						"awsKmsKeyArn": { "type": "string" },
						"disableLogs": { "type": "boolean" },
						"environment": { "type": "object", "patternProperties": {} },
						"tags": { "type": "object", "patternProperties": {} },
						"vpc": {
							"type": "object",
							"properties": {
								"securityGroupIds": {
									"type": "array",
									"items": { "type": "string" }
								},
								"subnetIds": {
									"type": "array",
									"items": { "type": "string" }
								}
							}
						},
						"package": {
							"type": "object",
							"properties": {
								"include": {
									"type": "array",
									"items": { "type": "string" }
								},
								"exclude": {
									"type": "array",
									"items": { "type": "string" }
								},
								"individually": { "type": "boolean" },
								"artifact": { "type": "string" }
							}
						},
						"layers": { "type": "array", "items": { "type": "string" } },
						"tracing": {
							"type": "string",
							"enum": ["Active", "PassThrough"]
						},
						"condition": { "type": "string" },
						"dependsOn": { "type": "array", "items": { "type": "string" } },
						"destinations": {
							"type": "object",
							"properties": {
								"onSuccess": { "type": "string" },
								"onFailure": { "type": "string" }
							}
						},
						"events": {
							"type": "array",
							"items": {
								"type": "object",
								"properties": {
									"http": {
										"type": "object",
										"required": ["path", "method"],
										"properties": {
											"path": { "type": "string" },
											"method": {
												"anyOf": [
													{ "type": "string" },
													{
														"type": "string",
														"enum": ["get", "post", "put", "delete"]
													}
												]
											},
											"cors": { "type": "boolean" },
											"private": { "type": "boolean" },
											"authorizer": {
												"type": "object",
												"properties": {
													"name": { "type": "string" },
													"arn": { "type": "string" },
													"identitySource": { "type": "string" },
													"identityValidationExpression": {
														"type": "string"
													},
													"type": {
														"type": "string",
														"enum": ["token", "request"]
													},
													"resultTtlInSeconds": {
														"type": "number"
													}
												}
											}
										}
									},
									"httpApi": {
										"type": "object",
										"properties": {
											"method": {
												"anyOf": [
													{ "type": "string" },
													{
														"type": "string",
														"enum": ["get", "post", "put", "delete"]
													}
												]
											},
											"path": { "type": "string" },
											"authorizer": {
												"type": "object",
												"properties": {
													"name": { "type": "string" },
													"scopes": {
														"type": "array",
														"items": { "type": "string" }
													}
												}
											}
										}
									},
									"websocket": {
										"type": "object",
										"properties": {
											"route": { "type": "string" },
											"routeResponseSelectionExpression": { "type": "string" },
											"authorizer": {
												"type": "object",
												"properties": {
													"arn": { "type": "string" },
													"identitySource": {
														"type": "array",
														"items": { "type": "string" }
													}
												}
											}
										}
									},
									"s3": {
										"type": "object",
										"properties": {
											"bucket": { "type": "string" },
											"event": { "type": "string" },
											"rules": {
												"type": "array",
												"items": {
													"type": "object",
													"properties": {
														"prefix": { "type": "string" },
														"suffix": { "type": "string" }
													}
												}
											},
											"existing": { "type": "boolean" }
										}
									},
									"schedule": {
										"type": "object",
										"properties": {
											"name": { "type": "string" },
											"description": { "type": "string" },
											"rate": { "type": "string" },
											"enabled": { "type": "boolean" },
											"input": {
												"type": "object",
												"anyOf": [
													{ "patternProperties": {} },
													{
														"properties": {
															"stageParams": {
																"type": "object",
																"properties": {
																	"stage": { "type": "string" }
																}
															}
														}
													}
												]
											},
											"inputPath": { "type": "string" },
											"inputTransformer": {
												"type": "object",
												"properties": {
													"inputPathsMap": {
														"type": "object",
														"properties": { "eventTime": { "type": "string" } }
													},
													"inputTemplate": { "type": "string" }
												}
											}
										}
									},
									"sns": {
										"type": "object",
										"properties": {
											"topicName": { "type": "string" },
											"displayName": { "type": "string" },
											"filterPolicy": {
												"type": "object",
												"patternProperties": {
													"^.*$": {
														"type": "array"
													}
												}
											},
											"redrivePolicy": {
												"type": "object",
												"properties": {
													"deadLetterTargetArn": { "type": "string" },
													"deadLetterTargetRef": { "type": "string" },
													"deadLetterTargetImport": {
														"type": "object",
														"properties": {
															"arn": { "type": "string" },
															"url": { "type": "string" }
														}
													}
												}
											}
										}
									},
									"sqs": {
										"type": "object",
										"properties": {
											"arn": { "type": "string" },
											"batchSize": { "type": "number" }
										}
									},
									"stream": {
										"type": "object",
										"properties": {
											"arn": { "type": "string" },
											"batchSize": { "type": "number" },
											"maximumRecordAgeInSeconds": { "type": "number" },
											"startingPosition": { "type": "string" },
											"enabled": { "type": "boolean" }
										}
									},
									"alexaSkill": {
										"type": "object",
										"properties": {
											"appId": { "type": "string" },
											"enabled": { "type": "boolean" }
										}
									},
									"alexaSmartHome": {
										"type": "object",
										"properties": {
											"appId": { "type": "string" },
											"enabled": { "type": "boolean" }
										}
									},
									"iot": {
										"type": "object",
										"properties": {
											"name": { "type": "string" },
											"description": { "type": "string" },
											"enabled": { "type": "boolean" },
											"sql": { "type": "string" },
											"sqlVersion": { "type": "string" }
										}
									},
									"cloudwatchEvent": {
										"type": "object",
										"properties": {
											"event": {
												"type": "object",
												"properties": {
													"source": {
														"type": "array",
														"items": { "type": "string" }
													},
													"detail-type": {
														"type": "array",
														"items": { "type": "string" }
													},
													"detail": {
														"type": "object",
														"properties": {
															"state": {
																"type": "array",
																"items": { "type": "string" }
															}
														}
													}
												}
											},
											"input": {
												"type": "object",
												"anyOf": [
													{ "patternProperties": {} },
													{
														"properties": {
															"stageParams": {
																"type": "object",
																"properties": {
																	"stage": { "type": "string" }
																}
															}
														}
													}
												]
											},
											"inputPath": { "type": "string" },
											"inputTransformer": {
												"type": "object",
												"properties": {
													"inputPathsMap": {
														"type": "object",
														"properties": { "eventTime": { "type": "string" } }
													},
													"inputTemplate": { "type": "string" }
												}
											}
										}
									},
									"cloudwatchLog": {
										"type": "object",
										"properties": {
											"logGroup": { "type": "string" },
											"filter": { "type": "string" }
										}
									},
									"cognitoUserPool": {
										"type": "object",
										"properties": {
											"pool": { "type": "string" },
											"trigger": { "type": "string" },
											"existing": { "type": "boolean" }
										}
									},
									"alb": {
										"type": "object",
										"properties": {
											"listenerArn": { "type": "string" },
											"priority": { "type": "number" },
											"conditions": {
												"type": "object",
												"properties": {
													"host": { "type": "string" },
													"path": { "type": "string" }
												}
											}
										}
									},
									"eventBridge": {
										"type": "object",
										"properties": {
											"schedule": { "type": "string" },
											"eventBus": { "type": "string" },
											"pattern": {
												"type": "object",
												"properties": {
													"source": {
														"type": "array",
														"items": { "type": "string" }
													},
													"detail-type": {
														"type": "array",
														"items": { "type": "string" }
													},
													"detail": {
														"type": "object",
														"properties": {
															"state": {
																"type": "array",
																"items": { "type": "string" }
															}
														}
													}
												}
											},
											"input": {
												"type": "object",
												"anyOf": [
													{ "patternProperties": {} },
													{
														"properties": {
															"stageParams": {
																"type": "object",
																"properties": {
																	"stage": { "type": "string" }
																}
															}
														}
													}
												]
											},
											"inputTransformer": {
												"type": "object",
												"properties": {
													"inputPathsMap": {
														"type": "object",
														"properties": { "eventTime": { "type": "string" } }
													},
													"inputTemplate": { "type": "string" }
												}
											}
										}
									},
									"cloudFront": {
										"type": "object",
										"properties": {
											"eventType": { "type": "string" },
											"includeBody": { "type": "array" },
											"pathPattern": { "type": "string" },
											"origin": {
												"type": "object",
												"properties": {
													"DomainName": { "type": "string" },
													"OriginPath": { "type": "string" },
													"CustomOriginConfig": {
														"type": "object",
														"properties": {
															"OriginProtocolPolicy": { "type": "string" }
														}
													}
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
		},
		"frameworkVersion": { "type": "string" },
		"disabledDeprecations": { "type": "array", "items": { "type": "string" } },
		"provider": {
			"type": "object",
			"properties": {
				"name": { "type": "string", "enum": ["aws", "google"] }
			},
			"oneOf": [
				{
					"if": {
						"properties": {
							"name": { "const": "aws" }
						}
					},
					"then": {
						"anyOf": [
							{
								"properties": {
									"runtime": {
										"$ref": "#/definitions/AWSRunTime"
									},
									"stage": { "type": "string" },
									"region": { "type": "string" },
									"stackName": { "type": "string" },
									"apiName": { "type": "string" },
									"websocketsApiName": { "type": "string" },
									"websocketsApiRouteSelectionExpression": { "type": "string" },
									"profile": { "type": "string" },
									"memorySize": { "type": "number" },
									"reservedConcurrency": { "type": "number" },
									"timeout": { "type": "number" },
									"logRetentionInDays": { "type": "number" },
									"deploymentBucket": {
										"type": "object",
										"properties": {
											"name": { "type": "string" },
											"maxPreviousDeploymentArtifacts": { "type": "number" },
											"blockPublicAccess": { "type": "boolean" },
											"serverSideEncryption": { "type": "string" },
											"sseKMSKeyId": { "type": "string" },
											"sseCustomerAlgorithim": { "type": "string" },
											"sseCustomerKey": { "type": "string" },
											"sseCustomerKeyMD5": { "type": "string" },
											"tags": {
												"type": "object",
												"properties": {}
											}
										}
									},
									"deploymentPrefix": { "type": "string" },
									"role": { "type": "string" },
									"rolePermissionsBoundary": { "type": "string" },
									"cfnRole": { "type": "string" },
									"versionFunctions": { "type": "boolean" },
									"environment": { "type": "object", "properties": {} },
									"endpointType": { "type": "string" },
									"apiKeys": {
										"type": "array",
										"items": {
											"anyOf": [
												{ "type": "string" },
												{
													"type": "object",
													"patternProperties": {
														"^.*$": {
															"type": "object",
															"properties": {
																"value": { "type": "string" },
																"description": { "type": "string" },
																"customerId": { "type": "string" }
															}
														}
													}
												}
											]
										}
									},
									"apiGateway": {
										"type": "object",
										"properties": {
											"restApiId": { "type": "string" },
											"restApiRootResourceId": { "type": "string" },
											"restApiResources": {
												"type": "array",
												"items": { "type": "string" }
											},
											"websocketApiId": { "type": "string" },
											"apiKeySourceType": { "type": "string" },
											"minimumCompressionSize": { "type": "number" },
											"description": { "type": "string" },
											"binaryMediaTypes": {
												"type": "array",
												"items": { "type": "string" }
											},
											"metrics": { "type": "boolean" }
										}
									},
									"alb": {
										"type": "object",
										"properties": {
											"targetGroupPrefix": { "type": "string" },
											"authorizers": {
												"type": "object",
												"patternProperties": {
													"^.*$": {
														"type": "object",
														"properties": {
															"type": { "type": "string" },
															"userPoolArn": { "type": "string" },
															"userPoolClientId": { "type": "string" },
															"userPoolDomain": { "type": "string" },
															"onUnauthenticatedRequest": { "type": "string" },
															"requestExtraParams": {
																"type": "object",
																"properties": {
																	"prompt": { "type": "string" },
																	"redirect": { "type": "boolean" }
																}
															},
															"scope": { "type": "string" },
															"sessionCookieName": { "type": "string" },
															"sessionTimeout": { "type": "number" },
															"authorizationEndpoint": { "type": "string" },
															"clientId": { "type": "string" },
															"clientSecret": { "type": "string" },
															"useExistingClientSecret": { "type": "boolean" },
															"issuer": { "type": "string" },
															"tokenEndpoint": { "type": "string" },
															"userInfoEndpoint": { "type": "string" }
														}
													}
												}
											}
										}
									},
									"httpApi": {
										"type": "object",
										"properties": {
											"id": { "type": "string" },
											"name": { "type": "string" },
											"payload": { "type": "string" },
											"cors": { "type": "boolean" },
											"authorizers": {
												"type": "object",
												"patternProperties": {
													"^.*$": {
														"type": "object",
														"properties": {
															"identitySource": { "type": "string" },
															"issuerUrl": { "type": "string" },
															"audience": {
																"type": "array",
																"items": { "type": "string" }
															}
														}
													}
												}
											}
										}
									},
									"usagePlan": {
										"type": "object",
										"properties": {
											"quota": {
												"type": "object",
												"properties": {
													"limit": { "type": "number" },
													"offset": { "type": "number" },
													"period": { "type": "string" }
												}
											},
											"throttle": {
												"type": "object",
												"properties": {
													"burstLimit": { "type": "number" },
													"rateLimit": { "type": "number" }
												}
											},
											"stackTags": { "type": "object", "properties": {} },
											"iamManagedPolicies": {
												"type": "array",
												"items": { "type": "string" }
											},
											"iamRoleStatements": { "type": "array", "items": {} },
											"stackPolicy": {
												"type": "array",
												"items": {
													"type": "object",
													"properties": {
														"Effect": { "type": "string" },
														"Principal": { "type": "string" },
														"Resource": { "type": "string" },
														"Action": {
															"oneOf": [
																{ "type": "string" },
																{ "type": "array", "items": {} }
															]
														},
														"Condition": {
															"type": "object",
															"properties": {}
														}
													}
												}
											}
										}
									},
									"vpc": {
										"type": "object",
										"properties": {
											"securityGroupIds": {
												"type": "array",
												"items": { "type": "string" }
											},
											"subnetIds": {
												"type": "array",
												"items": { "type": "string" }
											}
										}
									},
									"notificationArns": {
										"type": "array",
										"items": { "type": "string" }
									},
									"stackParameters": {
										"type": "array",
										"items": {
											"type": "object",
											"properties": {
												"ParameterKey": { "type": "string" },
												"ParameterValue": { "type": "string" }
											}
										}
									},
									"resourcePolicy": {
										"type": "array",
										"items": {
											"type": "object",
											"properties": {
												"Effect": { "type": "string" },
												"Principal": { "type": "string" },
												"Action": { "type": "string" },
												"Resource": {
													"type": "array",
													"items": { "type": "string" }
												},
												"Condition": { "type": "object", "properties": {} }
											}
										}
									},
									"tags": { "type": "object", "properties": {} },
									"tracing": {
										"type": "object",
										"properties": {
											"apiGateway": { "type": "boolean" },
											"lambda": { "type": "boolean" }
										}
									},
									"logs": {
										"type": "object",
										"properties": {
											"restApi": {
												"type": "object",
												"properties": {
													"accessLogging": { "type": "boolean" },
													"executionLogging": { "type": "boolean" },
													"fullExecutionData": { "type": "boolean" },
													"roleManagedExternally": { "type": "boolean" },
													"format": { "type": "string" },
													"level": { "type": "string" },
													"role": { "type": "string" }
												}
											},
											"websocket": {
												"type": "object",
												"properties": { "level": { "type": "string" } }
											},
											"httpApi": {
												"type": "object",
												"properties": { "format": { "type": "string" } }
											},
											"frameworkLambda": { "type": "boolean" }
										}
									}
								}
							}
						]
					}
				}
			]
		},
		"layers": {
			"type": "object",
			"patternProperties": {
				"^.*$": {
					"type": "object",
					"properties": {
						"path": { "type": "string" },
						"name": { "type": "string" },
						"description": { "type": "string" },
						"licenseInfo": { "type": "string" },
						"compatibleRuntimes": {
							"type": "array",
							"items": { "type": "string" }
						},
						"allowedAccounts": {
							"type": "array",
							"items": { "type": "string" }
						}
					}
				}
			}
		},
		"resources": { "type": "object", "properties": {} }
	},

	"definitions": {
		"CustomLocalstack": {
			"properties": {
				"localstack": {
					"type": "object",
					"anyOf": [
						{
							"patternProperties": { "^.*$": {} }
						},
						{
							"properties": {
								"stages": {
									"type": "array",
									"items": { "type": "string", "default": "local" }
								},
								"host": { "type": "string", "default": "http://localhost" },
								"autostart": { "type": "boolean", "default": true },
								"endpoints": {
									"type": "object",
									"anyOf": [
										{ "patternProperties": { "^.*$": {} } },
										{
											"properties": {
												"APIGateway": {
													"type": "string",
													"default": "http://localhost:4567"
												},
												"CloudFormation": {
													"type": "string",
													"default": "http://localhost:4581"
												},
												"CloudWatch": {
													"type": "string",
													"default": "http://localhost:4582"
												},
												"DynamoDB": {
													"type": "string",
													"default": "http://localhost:4569"
												},
												"DynamoDBStreams": {
													"type": "string",
													"default": "http://localhost:4570"
												},
												"ES": {
													"type": "string",
													"default": "http://localhost:4571"
												},
												"EC2": {
													"type": "string",
													"default": "http://localhost:4597"
												},
												"IAM": {
													"type": "string",
													"default": "http://localhost:4593"
												},
												"Firehose": {
													"type": "string",
													"default": "http://localhost:4573"
												},
												"Kinesis": {
													"type": "string",
													"default": "http://localhost:4568"
												},
												"Lambda": {
													"type": "string",
													"default": "http://localhost:4574"
												},
												"Redshift": {
													"type": "string",
													"default": "http://localhost:4577"
												},
												"Route53": {
													"type": "string",
													"default": "http://localhost:4580"
												},
												"S3": {
													"type": "string",
													"default": "http://localhost:4572"
												},
												"SES": {
													"type": "string",
													"default": "http://localhost:4579"
												},
												"SNS": {
													"type": "string",
													"default": "http://localhost:4575"
												},
												"SQS": {
													"type": "string",
													"default": "http://localhost:4576"
												},
												"StepFunctions": {
													"type": "string",
													"default": "http://localhost:4585"
												}
											}
										}
									]
								},
								"lambda": {
									"type": "object",
									"anyOf": [
										{ "patternProperties": {} },
										{
											"properties": {
												"mountCode": { "type": "boolean", "default": true }
											}
										}
									]
								},
								"docker": {
									"type": "object",
									"anyOf": [
										{ "patternProperties": {} },
										{
											"properties": {
												"sudo": { "type": "boolean", "default": false }
											}
										}
									]
								}
							}
						}
					]
				}
			}
		},
		"AWSRunTime": {
			"type": "string",
			"enum": [
				"nodejs10.x",
				"nodejs12.x",
				"python3.8",
				"python3.7",
				"python3.6",
				"ruby2.7",
				"ruby2.5",
				"java11",
				"java8",
				"go1.x",
				"dotnetcore3.1",
				"dotnetcore2.1"
			]
		}
	}
}
